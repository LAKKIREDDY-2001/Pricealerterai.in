<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reset Password - AI Price Alert</title>
  <link rel="stylesheet" href="./static/auth.css">
</head>
<body>
  <div class="auth-container"><div class="auth-card">
    <h2>Set New Password</h2>
    <form id="reset-form" class="auth-form">
      <div class="form-group"><label>Email</label><input id="email" type="email" required></div>
      <div class="form-group"><label>New Password</label><input id="password" type="password" minlength="6" required></div>
      <div class="form-group"><label>Confirm Password</label><input id="confirm" type="password" minlength="6" required></div>
      <button type="submit" class="auth-btn"><span>Update Password</span></button>
      <div id="error-message" class="error-message" style="display:none"></div>
      <div id="success-message" class="success-message" style="display:none;color:#16a34a;font-weight:700"></div>
    </form>
    <p><a href="./login.html">Back to Login</a></p>
  </div></div>
  <script>
    const usersKey = 'pa_users_v2';
    const params = new URLSearchParams(window.location.search);
    const qEmail = params.get('email');
    if (qEmail) document.getElementById('email').value = qEmail;

    const showError = (msg) => {
      const el = document.getElementById('error-message');
      el.textContent = msg;
      el.style.display = 'block';
    };

    document.getElementById('reset-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirm').value;
      if (password !== confirm) return showError('Passwords do not match.');

      const users = JSON.parse(localStorage.getItem(usersKey) || '[]');
      const idx = users.findIndex(u => u.email === email);
      if (idx < 0) return showError('No account found for this email.');
      users[idx].password = password;
      localStorage.setItem(usersKey, JSON.stringify(users));
      const ok = document.getElementById('success-message');
      ok.textContent = 'Password updated. Redirecting to login...';
      ok.style.display = 'block';
      setTimeout(() => window.location.href = './login.html', 900);
    });
  </script>
</body>
</html>
